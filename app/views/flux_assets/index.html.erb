<% content_for :stylesheets do %>    
<style>

/* flux-asset-browser
------------------------------------- */

body, html {
  margin: 0;
  padding: 0;
  font-family: 'Lucida Grande', sans-serif;
}

#flux-asset-browser {
  position: relative;
}

#flux-toolbar {
  position:fixed;
  top:0px;
  width:100%;
  padding: 20px;
  background-color: #EBEBEB;
/*  background-image: -moz-linear-gradient(center top , #EBEBEB, #CCCCCC);*/
  border-bottom:1px solid #999999; 
  -moz-box-shadow: 2px 2px 5px rgba(0,0,0,0.5); 
  -webkit-box-shadow: 2px 2px 5px rgba(0,0,0,0.5);   
}

.flux-asset {
  -moz-border-radius:4px;
  -webkit-border-radius:4px;  
  border:3px solid #FFFFFF;
  margin:5px;
  overflow:hidden;
  padding: 5px;
/*  width: 20%;*/
  width: 256px;
  float: left;
  text-align: center;
}

#flux-tags {
  float: left;
}

.flux-tag {
  background: #6B7B86;
  color: #FFF;
  font-size:10px;
  margin:0 10px 0 0;
  padding: 3px 4px;
  
}
.flux-tag input {
  display: none;
}
.flux-tag.active {
  background: #000;
}

.flux-tag.filter-tag {
 background: #000;
}


#flux-actions {
/*  position: absolute;*/
  float: right;
  margin-right: 40px;
}

#flux-actions button {
  color: #fff;
  border: 0;
  background: green;
  font-weight: bold;
  -moz-border-radius: 5px;
  -webkit-border-radius: 5px;  
  padding: 5px;
}

#flux-assets {
 margin-top:80px;
}


#flux-assets .ui-selecting {
  border-color: #eee;
}

#flux-assets .ui-selected {
  -moz-box-shadow:0 0 4px #99CCFF;
  -webkit-box-shadow:0 0 4px #99CCFF;  
  border:3px solid #3366CC;
}








</style>

<% end %>

<% content_for :javascripts do %>
<%= javascript_include_tag  "http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" %>
<%= javascript_include_tag  "http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.6/jquery-ui.min.js" %>
<script>
  
  $(function() {
    
    /* tag filter
    ------------------------------------- */
    $( "#flux-tags input" ).click(function(e){      
      var el = $(e.target);

      $('#flux-tags label').removeClass('active');

      el.parent('label').addClass('active');
      
      var tag = $(e.target).attr('value');
      $('#flux-assets li').hide();
      $('#flux-assets li.' + tag ).show();
      // $( "#selectable" ).selectable('destroy');
      // $( "#selectable" ).selectable();
    });

    
    /* make images selectable
    ------------------------------------- */  
    $("#flux-assets ol").selectable({
      filter: '.flux-asset'
    });

                        
    /* return selected images to gallery
    ------------------------------------- */
    $('#flux-use-button').click(function(e){
    
      e.preventDefault();
    
      var data = [];
      var selected = $('#flux-assets .ui-selected img');

      selected.each(function(idx, item) {

        var item = $(item);
        var img = {};

        img.public_url = item.attr('data-public-url');
        img.description = item.attr('data-description');        

        data.push(img)        
      });        
            
      parent.$(parent.document).trigger('flux:updateGallery', [data]);
          
    });            

  });
  
</script>

<% end %>

<div id="flux-asset-browser">

  <form id="flux-form" action="<%= url_for(:action => 'list') %>" method="GET">


  <div id="flux-toolbar">

    <div id="flux-tags">  
  	  <% @tags.each do |tag| 
  	    tagname = tag.tag
  	    is_filter = (tag.tag == FluxAsset::FILTER_TAG)
  	    class_name = (is_filter ? 'filter-tag' : '')
  	  %>
      <label class="flux-tag <%= class_name %>" for="radio-<%= tagname.parameterize %>" data-tag-filter="tag_<%= tag.id %>">
  		  <input type="radio" id="radio-<%= tagname.parameterize %>" <%= "checked" if is_filter  %> class="<%= class_name %>" name="radio" value="tag_<%= tag.id %>">
  		  <%= tagname %>
  		</label>
  		<% end %>
    </div>
    
    <div id="flux-actions">
      <button id="flux-use-button">Use selected images</button>
      <!-- <input type="submit" value="Refresh"> -->
    </div>

  </div>    

    <div id="flux-assets">  
      <ol>
      <% @assets.each do |asset| %>
        <% next unless asset.public_url %>
      	<li class="flux-asset <%= asset.tags.collect { |t| "tag_#{t.id}"}.join(' ') %>">
          <!-- <input type="checkbox" value="<%= asset.image_url %>" name="assets"> -->
      	  <img src="<%= asset.large_thumbnail_url %>" data-public-url="<%= asset.image_url %>" data-description="<%= asset.description %>">
      	</li>
      <% end %>	  
      </ol>
    </div>
  


  </form>

</div>